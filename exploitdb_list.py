from pymongo import MongoClient
import csv

client = MongoClient('mongodb://localhost:27017')
db = client['exploits']
collection = db['exploitdb']
collection.create_index([('filename', 1)], unique=True)

def parse_description_file(path):
    with open(path + '/files_exploits.csv', mode='r') as csv_file:

        csv_reader = csv.DictReader(csv_file)
        line_count = 0
        for row in csv_reader:
            if line_count == 0:
                print(f'Column names are {", ".join(row)}')
                line_count += 1
            filename = row["file"].split('/')[-1]
            myDict = {
                "id": row["id"],
                "filename": filename,
                "title": row["description"],
                "type": row["type"],
                "platform": row["platform"]
            }

            collection.update({"filename": filename}, myDict, upsert=True)
            line_count += 1
        print(f'Processed {line_count} lines.')

