import sys
sys.path.append('/home/john/Project/CVE_crawler/')
from Mongo_Connection import get_db as mongodb
import csv
exploits = "exploits"
exploitdb = "exploitdb"

db = mongodb.get_db()
collection = db[exploitdb]
collection.create_index([('filename', 1)], unique=True)

def parse_description_file(path):
    with open(path + '/files_exploits.csv', mode='r', encoding='utf-8') as csv_file:

        csv_reader = csv.DictReader(csv_file)
        line_count = 0
        for row in csv_reader:

            if line_count == 0:
                print(f'Column names are {", ".join(row)}')
                line_count += 1
            filename = row["file"].split('/')[-1]
            myDict = {
                "id": row["id"],
                "filename": filename,
                "title": row["description"],
                "type": row["type"],
                "platform": row["platform"],
                "date": row['date']
            }

            collection.update({"filename": filename}, myDict, upsert=True)
            line_count += 1
        print(f'Processed {line_count} lines.')

